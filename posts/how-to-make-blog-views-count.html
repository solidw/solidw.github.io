<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@site"/><meta name="twitter:creator" content="@handle"/><meta property="og:url" content="https://solidw.github.io"/><meta property="og:type" content="website"/><meta property="og:image" content="https://solidw.github.io/me.jpeg"/><meta property="og:image:alt" content="펜로즈의 삼각형"/><meta property="og:image:width" content="300"/><meta property="og:image:height" content="300"/><meta property="og:locale" content="ko_KR"/><meta property="og:site_name" content="solidw의 블로그"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><title>한 땀 한 땀 블로그 만들기 - 조회수 세기 |  solidw의 블로그</title><meta name="robots" content="index,follow"/><meta name="description" content="내 글을 사람들이 얼마나 보는지 알고 싶어졌다. 무료 Heroku dynos 도입과 함께 NestJS를 써보자"/><meta property="og:title" content="한 땀 한 땀 블로그 만들기 - 조회수 세기 |  solidw의 블로그"/><meta property="og:description" content="내 글을 사람들이 얼마나 보는지 알고 싶어졌다. 무료 Heroku dynos 도입과 함께 NestJS를 써보자"/><link rel="canonical" href="https://solidw.github.io/posts/how-to-make-blog-views-count"/><meta name="next-head-count" content="19"/><meta name="theme-color" content="#e5e6ff"/><meta name="naver-site-verification" content="10cd16441bbd706012ce8f01d85b6b34a2c5dfce"/><meta name="google-site-verification" content="rLTjyFm7D8DYd7KSU-QEXXEskWiK-7CxvagBJZkmDEY"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-c491b2a411a4f8fa.js" defer=""></script><script src="/_next/static/chunks/framework-bd11988bb31fcb16.js" defer=""></script><script src="/_next/static/chunks/main-52bb377f2a94a2c9.js" defer=""></script><script src="/_next/static/chunks/pages/_app-98d326545e498a95.js" defer=""></script><script src="/_next/static/chunks/157-70683cf36c90572a.js" defer=""></script><script src="/_next/static/chunks/921-39a4856f505e4abb.js" defer=""></script><script src="/_next/static/chunks/105-efde3214925289c2.js" defer=""></script><script src="/_next/static/chunks/790-16189a57cd91e563.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bpath%5D-2b694fd7d3d0c0df.js" defer=""></script><script src="/_next/static/wfqkA46kRnNN_8jvVjxMr/_buildManifest.js" defer=""></script><script src="/_next/static/wfqkA46kRnNN_8jvVjxMr/_ssgManifest.js" defer=""></script></head><link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/manifest.json"/><meta name="msapplication-TileColor" content="#ffffff"/><meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png"/><meta name="theme-color" content="#ffffff"/><body><div id="__next"><style data-emotion="css-global 19g0mvz">html{line-height:1.15;-webkit-text-size-adjust:100%;}body{margin:0;}main{display:block;}h1{font-size:2em;margin:0.67em 0;}hr{box-sizing:content-box;height:0;overflow:visible;}pre{font-family:monospace,monospace;font-size:1em;}a{background-color:transparent;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bolder;}code,kbd,samp{font-family:monospace,monospace;font-size:1em;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-decoration{-webkit-appearance:none;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:-webkit-box;display:-webkit-list-item;display:-ms-list-itembox;display:list-item;}template{display:none;}[hidden]{display:none;}@font-face{font-family:"VitroCore";src:local("/fonts/VitroCore.ttf"),url("/fonts/VitroCore.ttf");}@font-face{font-family:"VitroPride";src:local("/fonts/VitroPride.ttf"),url("/fonts/VitroPride.ttf");}body{font-family:"VitroPride","VitroCore","SpoqaHanSansRegular",Arial,Helvetica,sans-serif;font-size:1.6rem;}html{font-size:62.5%;}*{box-sizing:border-box;word-break:break-all;}html{color:#001f3f;background-color:#e5e6ff;}</style><style data-emotion="css 1xaekgw">.css-1xaekgw{margin-top:20px;}</style><style data-emotion="css 1tm3qx5">.css-1tm3qx5{position:-webkit-sticky;position:sticky;top:0;height:80px;z-index:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;padding:0px 30px;background-color:#e5e6ff;box-shadow:5px 5px 5px #c3c4d9,-5px -5px 5px #ffffff;}</style><header class="css-1tm3qx5"><style data-emotion="css b2tuel">.css-b2tuel{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:20px;font-size:1.4rem;list-style:none;margin:0;padding:0;}</style><ul class="css-b2tuel"><li class="css-0"><style data-emotion="css pb9bc6">.css-pb9bc6{font-size:2.4rem;font-weight:bold;}</style><style data-emotion="css i8ev83">.css-i8ev83{-webkit-text-decoration:none;text-decoration:none;color:inherit;font-size:2.4rem;font-weight:bold;}</style><a class="css-i8ev83" href="/">solidw</a></li></ul><style data-emotion="css p9mjn3">.css-p9mjn3{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;font-size:1.8rem;}</style><style data-emotion="css kav0r6">.css-kav0r6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:20px;font-size:1.4rem;list-style:none;margin:0;padding:0;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;font-size:1.8rem;}</style><ul class="css-kav0r6"><li class="css-0"><style data-emotion="css co7u6l">.css-co7u6l{-webkit-text-decoration:none;text-decoration:none;color:inherit;}</style><a class="css-co7u6l" href="/me"><style data-emotion="css fd2297">.css-fd2297{padding:8px 20px;font-size:1.6rem;border-radius:8px;border:none;-webkit-transition:all 0.2s ease-in-out;transition:all 0.2s ease-in-out;color:#001f3f;background:#e5e6ff;box-shadow:5px 5px 10px #c3c4d9,-5px -5px 10px #ffffff;}.css-fd2297:hover{box-shadow:2px 2px 5px #c3c4d9,-2px -2px 5px #ffffff;}.css-fd2297:active{box-shadow:inset 1px 1px 2px #c3c4d9,inset -1px -1px 2px #ffffff;}</style><button class="css-fd2297">ME</button></a></li><li class="css-0"><a class="css-co7u6l" href="/"><button class="css-fd2297">POST</button></a></li></ul></header><style data-emotion="css dzcaqd">.css-dzcaqd{-webkit-flex:1;-ms-flex:1;flex:1;margin-top:20px;}</style><main class="css-dzcaqd"><style data-emotion="css hm6m8u">.css-hm6m8u{max-width:900px;margin:0 auto;height:100%;}</style><div class="css-hm6m8u"><style data-emotion="css 13fupha">.css-13fupha{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;border-radius:15px;padding:20px;box-shadow:3px 3px 5px #c3c4d9,-3px -3px 5px #ffffff;}</style><div class="css-13fupha"><style data-emotion="css 1rsxa0p">.css-1rsxa0p{margin-bottom:10px;}</style><style data-emotion="css 1e40k0e">.css-1e40k0e{font-size:3.2rem;margin-bottom:10px;}</style><h1 class="css-1e40k0e">한 땀 한 땀 블로그 만들기 - 조회수 세기</h1><span class="css-1rsxa0p">2022. 07. 31.</span><style data-emotion="css uewl2b">.css-uewl2b{margin-bottom:20px;}</style><style data-emotion="css 183tf0">.css-183tf0{height:1px;margin:5px 0px;margin-bottom:20px;}</style><hr class="css-183tf0"/><style data-emotion="css 1kmeffr">.css-1kmeffr{gap:20px;}</style><style data-emotion="css d0l4l7">.css-d0l4l7{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;gap:20px;}</style><div class="css-d0l4l7"><style data-emotion="css 1pzndko">.css-1pzndko{line-height:3rem;word-break:break-all;}.css-1pzndko img{width:100%;border:1px solid rgba(0, 0, 0, 0.2);}.css-1pzndko h1:before,.css-1pzndko h2:before,.css-1pzndko h3:before,.css-1pzndko h4:before,.css-1pzndko h5:before,.css-1pzndko h6:before{content:"";display:block;padding-top:90px;margin-top:-90px;}.css-1pzndko h1:hover .anchor,.css-1pzndko h2:hover .anchor,.css-1pzndko h3:hover .anchor,.css-1pzndko h4:hover .anchor,.css-1pzndko h5:hover .anchor,.css-1pzndko h6:hover .anchor{visibility:visible;}.css-1pzndko h1,.css-1pzndko h2,.css-1pzndko h3{margin-top:40px;margin-bottom:40px;}.css-1pzndko .anchor{visibility:hidden;margin-left:5px;vertical-align:middle;}.css-1pzndko blockquote{box-shadow:inset 1px 1px 2px #c3c4d9,inset -1px -1px 2px #ffffff;margin:0;padding:5px;border-left:0.25em solid #6667AB;}.css-1pzndko blockquote>*{margin:0;}.css-1pzndko p>code{box-shadow:inset 1px 1px 2px #c3c4d9,inset -1px -1px 2px #ffffff;padding:5px;margin-left:3px;margin-right:3px;color:#d55373;}.css-1pzndko:not(pre)>code[class*="language-"],.css-1pzndko pre{box-shadow:inset 3px 3px 5px #c3c4d9,inset -3px -3px 5px #ffffff;border:none;padding:15px;}.css-1pzndko code[class*="language-"],.css-1pzndko pre[class*="language-"]{background:none;color:hsl(230, 8%, 24%);font-family:"Fira Code","Fira Mono",Menlo,Consolas,"DejaVu Sans Mono",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;}.css-1pzndko code[class*="language-"]::-moz-selection,.css-1pzndko code[class*="language-"] *::-moz-selection,.css-1pzndko pre[class*="language-"] *::-moz-selection{background:hsl(230, 1%, 90%);color:inherit;}.css-1pzndko code[class*="language-"]::selection,.css-1pzndko code[class*="language-"] *::selection,.css-1pzndko pre[class*="language-"] *::selection{background:hsl(230, 1%, 90%);color:inherit;}.css-1pzndko pre[class*="language-"]{padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em;}.css-1pzndko:not(pre)>code[class*="language-"]{padding:0.2em 0.3em;border-radius:0.3em;white-space:normal;}.css-1pzndko .token.comment,.css-1pzndko .token.prolog,.css-1pzndko .token.cdata{color:hsl(230, 4%, 64%);}.css-1pzndko .token.doctype,.css-1pzndko .token.punctuation,.css-1pzndko .token.entity{color:hsl(230, 8%, 24%);}.css-1pzndko .token.attr-name,.css-1pzndko .token.class-name,.css-1pzndko .token.boolean,.css-1pzndko .token.constant,.css-1pzndko .token.number,.css-1pzndko .token.atrule{color:hsl(35, 99%, 36%);}.css-1pzndko .token.keyword{color:hsl(301, 63%, 40%);}.css-1pzndko .token.property,.css-1pzndko .token.tag,.css-1pzndko .token.symbol,.css-1pzndko .token.deleted,.css-1pzndko .token.important{color:hsl(5, 74%, 59%);}.css-1pzndko .token.selector,.css-1pzndko .token.string,.css-1pzndko .token.char,.css-1pzndko .token.builtin,.css-1pzndko .token.inserted,.css-1pzndko .token.regex,.css-1pzndko .token.attr-value,.css-1pzndko .token.attr-value>.token.punctuation{color:hsl(119, 34%, 47%);}.css-1pzndko .token.variable,.css-1pzndko .token.operator,.css-1pzndko .token.function{color:hsl(221, 87%, 60%);}.css-1pzndko .token.url{color:hsl(198, 99%, 37%);}.css-1pzndko .token.attr-value>.token.punctuation.attr-equals,.css-1pzndko .token.special-attr>.token.attr-value>.token.value.css{color:hsl(230, 8%, 24%);}.css-1pzndko .language-css .token.selector{color:hsl(5, 74%, 59%);}.css-1pzndko .language-css .token.property{color:hsl(230, 8%, 24%);}.css-1pzndko .language-css .token.function,.css-1pzndko .language-css .token.url>.token.function{color:hsl(198, 99%, 37%);}.css-1pzndko .language-css .token.url>.token.string.url{color:hsl(119, 34%, 47%);}.css-1pzndko .language-css .token.important,.css-1pzndko .language-css .token.atrule .token.rule{color:hsl(301, 63%, 40%);}.css-1pzndko .language-javascript .token.operator{color:hsl(301, 63%, 40%);}.css-1pzndko .language-javascript .token.template-string>.token.interpolation>.token.interpolation-punctuation.punctuation{color:hsl(344, 84%, 43%);}.css-1pzndko .language-json .token.operator{color:hsl(230, 8%, 24%);}.css-1pzndko .language-json .token.null.keyword{color:hsl(35, 99%, 36%);}.css-1pzndko .language-markdown .token.url,.css-1pzndko .language-markdown .token.url>.token.operator,.css-1pzndko .language-markdown .token.url-reference.url>.token.string{color:hsl(230, 8%, 24%);}.css-1pzndko .language-markdown .token.url>.token.content{color:hsl(221, 87%, 60%);}.css-1pzndko .language-markdown .token.url>.token.url,.css-1pzndko .language-markdown .token.url-reference.url{color:hsl(198, 99%, 37%);}.css-1pzndko .language-markdown .token.blockquote.punctuation,.css-1pzndko .language-markdown .token.hr.punctuation{color:hsl(230, 4%, 64%);font-style:italic;}.css-1pzndko .language-markdown .token.code-snippet{color:hsl(119, 34%, 47%);}.css-1pzndko .language-markdown .token.bold .token.content{color:hsl(35, 99%, 36%);}.css-1pzndko .language-markdown .token.italic .token.content{color:hsl(301, 63%, 40%);}.css-1pzndko .language-markdown .token.strike .token.content,.css-1pzndko .language-markdown .token.strike .token.punctuation,.css-1pzndko .language-markdown .token.list.punctuation,.css-1pzndko .language-markdown .token.title.important>.token.punctuation{color:hsl(5, 74%, 59%);}.css-1pzndko .token.bold{font-weight:bold;}.css-1pzndko .token.comment,.css-1pzndko .token.italic{font-style:italic;}.css-1pzndko .token.entity{cursor:help;}.css-1pzndko .token.namespace{opacity:0.8;}.css-1pzndko .token.token.tab:not(:empty):before,.css-1pzndko .token.token.cr:before,.css-1pzndko .token.token.lf:before,.css-1pzndko .token.token.space:before{color:hsla(230, 8%, 24%, 0.2);}.css-1pzndko div.code-toolbar>.toolbar.toolbar>.toolbar-item{margin-right:0.4em;}.css-1pzndko div.code-toolbar>.toolbar.toolbar>.toolbar-item>button,.css-1pzndko div.code-toolbar>.toolbar.toolbar>.toolbar-item>a,.css-1pzndko div.code-toolbar>.toolbar.toolbar>.toolbar-item>span{background:hsl(230, 1%, 90%);color:hsl(230, 6%, 44%);padding:0.1em 0.4em;border-radius:0.3em;}.css-1pzndko div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:hover,.css-1pzndko div.code-toolbar>.toolbar.toolbar>.toolbar-item>button:focus,.css-1pzndko div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:hover,.css-1pzndko div.code-toolbar>.toolbar.toolbar>.toolbar-item>a:focus,.css-1pzndko div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:hover,.css-1pzndko div.code-toolbar>.toolbar.toolbar>.toolbar-item>span:focus{background:hsl(230, 1%, 78%);color:hsl(230, 8%, 24%);}.css-1pzndko .line-highlight.line-highlight{background:hsla(230, 8%, 24%, 0.05);}.css-1pzndko .line-highlight.line-highlight:before,.css-1pzndko .line-highlight.line-highlight[data-end]:after{background:hsl(230, 1%, 90%);color:hsl(230, 8%, 24%);padding:0.1em 0.6em;border-radius:0.3em;box-shadow:0 2px 0 0 rgba(0, 0, 0, 0.2);}.css-1pzndko pre[id].linkable-line-numbers.linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:hsla(230, 8%, 24%, 0.05);}.css-1pzndko .line-numbers.line-numbers .line-numbers-rows,.css-1pzndko .command-line .command-line-prompt{border-right-color:hsla(230, 8%, 24%, 0.2);}.css-1pzndko .line-numbers .line-numbers-rows>span:before,.css-1pzndko .command-line .command-line-prompt>span:before{color:hsl(230, 1%, 62%);}.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-1,.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-5,.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-9{color:hsl(5, 74%, 59%);}.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-2,.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-6,.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-10{color:hsl(119, 34%, 47%);}.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-3,.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-7,.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-11{color:hsl(221, 87%, 60%);}.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-4,.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-8,.css-1pzndko .rainbow-braces .token.token.punctuation.brace-level-12{color:hsl(301, 63%, 40%);}.css-1pzndko pre.diff-highlight>code .token.token.deleted:not(.prefix),.css-1pzndko pre>code.diff-highlight .token.token.deleted:not(.prefix){background-color:hsla(353, 100%, 66%, 0.15);}.css-1pzndko pre.diff-highlight>code .token.token.deleted:not(.prefix)::-moz-selection,.css-1pzndko pre.diff-highlight>code .token.token.deleted:not(.prefix) *::-moz-selection,.css-1pzndko pre>code.diff-highlight .token.token.deleted:not(.prefix)::-moz-selection,.css-1pzndko pre>code.diff-highlight .token.token.deleted:not(.prefix) *::-moz-selection{background-color:hsla(353, 95%, 66%, 0.25);}.css-1pzndko pre.diff-highlight>code .token.token.deleted:not(.prefix)::selection,.css-1pzndko pre.diff-highlight>code .token.token.deleted:not(.prefix) *::selection,.css-1pzndko pre>code.diff-highlight .token.token.deleted:not(.prefix)::selection,.css-1pzndko pre>code.diff-highlight .token.token.deleted:not(.prefix) *::selection{background-color:hsla(353, 95%, 66%, 0.25);}.css-1pzndko pre.diff-highlight>code .token.token.inserted:not(.prefix),.css-1pzndko pre>code.diff-highlight .token.token.inserted:not(.prefix){background-color:hsla(137, 100%, 55%, 0.15);}.css-1pzndko pre.diff-highlight>code .token.token.inserted:not(.prefix)::-moz-selection,.css-1pzndko pre.diff-highlight>code .token.token.inserted:not(.prefix) *::-moz-selection,.css-1pzndko pre>code.diff-highlight .token.token.inserted:not(.prefix)::-moz-selection,.css-1pzndko pre>code.diff-highlight .token.token.inserted:not(.prefix) *::-moz-selection{background-color:hsla(135, 73%, 55%, 0.25);}.css-1pzndko pre.diff-highlight>code .token.token.inserted:not(.prefix)::selection,.css-1pzndko pre.diff-highlight>code .token.token.inserted:not(.prefix) *::selection,.css-1pzndko pre>code.diff-highlight .token.token.inserted:not(.prefix)::selection,.css-1pzndko pre>code.diff-highlight .token.token.inserted:not(.prefix) *::selection{background-color:hsla(135, 73%, 55%, 0.25);}.css-1pzndko .prism-previewer.prism-previewer:before,.css-1pzndko .prism-previewer-gradient.prism-previewer-gradient div{border-color:hsl(0, 0, 95%);}.css-1pzndko .prism-previewer-color.prism-previewer-color:before,.css-1pzndko .prism-previewer-gradient.prism-previewer-gradient div,.css-1pzndko .prism-previewer-easing.prism-previewer-easing:before{border-radius:0.3em;}.css-1pzndko .prism-previewer.prism-previewer:after{border-top-color:hsl(0, 0, 95%);}.css-1pzndko .prism-previewer-flipped.prism-previewer-flipped.after{border-bottom-color:hsl(0, 0, 95%);}.css-1pzndko .prism-previewer-angle.prism-previewer-angle:before,.css-1pzndko .prism-previewer-time.prism-previewer-time:before,.css-1pzndko .prism-previewer-easing.prism-previewer-easing{background:hsl(0, 0%, 100%);}.css-1pzndko .prism-previewer-angle.prism-previewer-angle circle,.css-1pzndko .prism-previewer-time.prism-previewer-time circle{stroke:hsl(230, 8%, 24%);stroke-opacity:1;}.css-1pzndko .prism-previewer-easing.prism-previewer-easing circle,.css-1pzndko .prism-previewer-easing.prism-previewer-easing path,.css-1pzndko .prism-previewer-easing.prism-previewer-easing line{stroke:hsl(230, 8%, 24%);}.css-1pzndko .prism-previewer-easing.prism-previewer-easing circle{fill:transparent;}</style><div class="css-1pzndko"><h1 id="조회수를-세어보자">조회수를 세어보자<a class="anchor" href="#조회수를-세어보자"><svg class="autolink-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h1>
<p>문득 블로그에 글을 하나 둘 씩 쓰고 있지만, 나 외에 다른 사람들이 보는지 알 수 없었다. 내 블로그가 마치 맥북 기본 메모 앱이 되어버릴 것 같았다. 최초의 내가 블로그를 만든 이유는 Jekyll과 같은 정적 사이트 생성기로는 성에 안찼기도 하고, 한번쯤은 구현해보고 싶었던 뉴모피즘 디자인을 구현해보고 싶었던 것이다. 원하던 디자인의 블로그를 만들고 난 후 생각해보니 블로그는 결국 글을 쓰고 조회하는 것이 목적일텐데 내가 쓴 글을 사람들이 얼마나 볼 지 문득 궁금해졌다. 그래서 조회수를 세기로 했다.</p>
<h2 id="인스턴스를-찾아서">인스턴스를 찾아서<a class="anchor" href="#인스턴스를-찾아서"><svg class="autolink-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>조회수를 세기 위해 어떤 것이 필요할 지 생각해봤다. 현재 블로그는 정적 사이트로, 개발할 때 작성했던 마크다운 파일을 파일 시스템으로 읽어 GitHub Page에 빌드 후 올리는 방식이다. 즉 레포지토리에 저장된 파일은 매번 복사되어 GitHub Page 호스팅에 올라가기 때문에 포스트와 같은 방식으로 조회수를 저장할 순 없었다. s3 같은 스토리지를 사용할까 했지만 추후에 다른 기능이 추가된다면 데이터베이스가 유리해보였다. 이제 서버와 데이터베이스가 필요해졌다. 하지만 나는 트래픽이 적은(적다고 생각하는) 블로그를 위해서 24시간 켜져있는 별도의 PC를 구매하고 싶지 않았기 때문에 클라우드로 눈을 돌렸다.</p>
<p>클라우드 중 가장 먼저 생각난 것은 대중적인 AWS EC2 인스턴스였다. AWS에 계정을 새로 만들면 1년간 월 750시간을 무료로 사용할 수 있는 EC2를 제공하지만 여러 가지 변수로 과금될 수 있고 1년 후에는 무료가 아니게 된다는 것이 걸렸다. 그 다음 눈을 돌린 것은 Heroku 였다. 한번도 사용해보지 않았지만 블로그에 적당한 스펙의 Dynos를 무료로 지원한다. 게다가 Postgresql 데이터베이스도 지원한다. 그래서 Heroku를 이용해 서버와 데이터베이스를 구현하기로 정했다.</p>
<p><img src="/posts/how-to-make-blog-views-count/dynos.png" alt="Dynos"></p>
<blockquote>
<p>Dynos(Heroku에서의 isolated, virtualized linux container)</p>
</blockquote>
<h2 id="서버-어플리케이션-만들기">서버 어플리케이션 만들기<a class="anchor" href="#서버-어플리케이션-만들기"><svg class="autolink-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>가용한 서버가 준비됐으니 이제 서버 어플리케이션을 준비할 차례다. 최근에 NestJS에 관심이 생겼는데, 조회수를 세는 것이 NestJS를 사용해야 할만큼 통일성이 필요한 프로젝트는 아니었지만 시험 삼아 사용하기로 했다. NestJS의 셋업 경험은 굉장했다. cli로 nest project를 만들고(<code>nest new project-name</code>) CRUD Generator(<code>nest g resource posts</code>)로 보일러 플레이트를 뚝딱 만들었다.</p>
<p>이제 데이터베이스와 연결해야 하는데, 우선 로컬에서 postgresql을 설치하고(<code>brew install postgresql</code>), typeorm으로 DB와 동기화된 데이터를 관리한다.(<code>yarn install @nestjs/typeorm typeorm pg</code>) 이후의 일은 간단히 post를 id로 조회하는 API(findAll, findOne)를 구현하고, post의 views를 increament하는 API를 만들면 끝난다. 처음에는 post를 통째로 update하는 API로 만들었는데, 그러면 views를 임의로 0으로 만들거나 말도 안되는 숫자로 만들 수 있을 것 같아서 increment로 제한해서 구현했다. 코드는 <a href="https://github.com/solidw/solidw.github.io-server" target="_blank" rel="noopener noreferrer">Server Repo</a>에서 확인할 수 있다.</p>
<p>근 2년만에 서버를 만들어봐서 SQL문에 세미콜론을 안붙이고 확인하다가 왜 데이터가 안쌓이는지 한참 헤메기도 하고, 로컬에 database 연결하는 법도 한참 헤맸던 것 같다. TypeORM의 repository.create는 단순히 entity를 만드는 함수인데, save를 호출하지 않고 왜 db에서 row가 create가 안되지 하고 헤매기도 했다. 그렇지만 안하던 걸 해보니까 즐거웠다. 새로운 경험은 언제나 즐겁다.</p>
<p>서버 어플리케이션을 무사히 준비한 후 Heroku Dynos에 띄웠다. Heroku는 배포도 굉장히 간단했는데, Heroku 대시보드에서 GitHub 레포와 연결한 후 Procfile만 정의해주면 알아서 clone한 후 Procfile에 정의된 명령어(<code>yarn prod</code>)를 실행해줬다. 이제는 클라이언트에서 views를 조회하고 업데이트만 해주면 된다.</p>
<h2 id="클라이언트-기능-추가하기">클라이언트 기능 추가하기<a class="anchor" href="#클라이언트-기능-추가하기"><svg class="autolink-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>우선 Views를 직관적으로 표현해줄 수 있는 png 파일을 하나 받아오고 count를 받아서 렌더하는 <code>ViewCount.tsx</code> 컴포넌트를 만들었다. 클라이언트에서 기능을 구현하는 것은 익숙하기 때문에 금방 만들었다. react-query를 이용해서 포스트 페이지에 접속하면 모든 포스트에 대한 views를 받아오고, 포스트 페이지에 접속하면 increment 요청을 보내도록 했다. 한가지 염려되는 점은 세션ID를 체크하지 않아서 한 페이지에서 새로고침을 마구마구 하면 views가 마구마구 올라간다. 지금은 큰 문제가 될 것 같지 않아서 추후에 추가할 계획이다.</p>
<p><img src="/posts/how-to-make-blog-views-count/view-count.png" alt="ViewCount 컴포넌트"></p>
<blockquote>
<p>우측 하단의 컴포넌트</p>
</blockquote>
<h2 id="이대로-괜찮을까">이대로 괜찮을까?<a class="anchor" href="#이대로-괜찮을까"><svg class="autolink-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>고민이 있었다. 현재 클라이언트에 저장된 posts 파일에서 가져온 데이터만으로 정적 생성을 하고 있고, 이제는 서버에서도 post 데이터가 받아온다. 서버의 post 데이터는 views 값만 있다. 데이터의 관리 포인트가 2곳이 되었다. 그리고 id 값을 md 파일의 metadata로 손수 정의해주지만 새로운 포스팅을 쓸 때 다른 파일의 id와 중복되게 작성하는 등 실수할 여지가 큰 구조다. 궁극적으로는 포스트와 관련된 데이터를 모조리 서버로 옮기고 정적 생성할 때 서버에서 모든 데이터를 받아오는 것이 좋아보인다. 하지만 당장 필요하지 않으니 id 값을 조심스럽게 적어주기로 결정했다.</p>
<h2 id="후기">후기<a class="anchor" href="#후기"><svg class="autolink-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<p>주말을 이용해서 간단한 기능을 구현했다. 서버 구현할 때 조금 헤맸지만 앞으로 서버가 필요한 기능이 추가된다면 금방 추가할 수 있을 것 같다. 그리고 NestJS의 온보딩 경험이 꽤 괜찮아서 조금 더 관심을 갖고 사용하려고 한다. 이제 포스트의 views를 측정할 수 있게 되었으니 다음에는 코멘트 기능을 추가해야겠다. 블로그와 함께 나도 성장해서 더 풍성한 블로그가 되었으면 좋겠다.</p>
<h2 id="참고한-포스트">참고한 포스트<a class="anchor" href="#참고한-포스트"><svg class="autolink-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2>
<ul>
<li><a href="https://dev.to/omercalik/connecting-heroku-postgres-with-nestjs-backend-3p1j" target="_blank" rel="noopener noreferrer">Connecting Heroku Postgres with NestJS Backend</a></li>
</ul></div></div></div><div></div></div></main><style data-emotion="css 1lnw9wg">.css-1lnw9wg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:30px;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;white-space:pre;height:80px;}</style><footer class="css-1lnw9wg"><span>Copyright <!-- -->2022<!-- -->. </span><style data-emotion="css 1ovucv3">.css-1ovucv3{-webkit-text-decoration:none;text-decoration:none;color:inherit;color:#6667AB;}</style><a href="https://github.com/solidw" target="_blank" rel="noopener noreferrer" class="css-1ovucv3"><span>@solidw</span></a><span> All rights reserved.</span></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"metadata":{"id":9,"title":"한 땀 한 땀 블로그 만들기 - 조회수 세기","description":"내 글을 사람들이 얼마나 보는지 알고 싶어졌다. 무료 Heroku dynos 도입과 함께 NestJS를 써보자","to":"한 땀 한 땀 블로그를 만들고 싶은 사람들에게","timestamp":"2022-07-31T06:17:29.476Z","draft":false,"path":"how-to-make-blog-views-count"},"body":"# 조회수를 세어보자\n\n문득 블로그에 글을 하나 둘 씩 쓰고 있지만, 나 외에 다른 사람들이 보는지 알 수 없었다. 내 블로그가 마치 맥북 기본 메모 앱이 되어버릴 것 같았다. 최초의 내가 블로그를 만든 이유는 Jekyll과 같은 정적 사이트 생성기로는 성에 안찼기도 하고, 한번쯤은 구현해보고 싶었던 뉴모피즘 디자인을 구현해보고 싶었던 것이다. 원하던 디자인의 블로그를 만들고 난 후 생각해보니 블로그는 결국 글을 쓰고 조회하는 것이 목적일텐데 내가 쓴 글을 사람들이 얼마나 볼 지 문득 궁금해졌다. 그래서 조회수를 세기로 했다.\n\n## 인스턴스를 찾아서\n\n조회수를 세기 위해 어떤 것이 필요할 지 생각해봤다. 현재 블로그는 정적 사이트로, 개발할 때 작성했던 마크다운 파일을 파일 시스템으로 읽어 GitHub Page에 빌드 후 올리는 방식이다. 즉 레포지토리에 저장된 파일은 매번 복사되어 GitHub Page 호스팅에 올라가기 때문에 포스트와 같은 방식으로 조회수를 저장할 순 없었다. s3 같은 스토리지를 사용할까 했지만 추후에 다른 기능이 추가된다면 데이터베이스가 유리해보였다. 이제 서버와 데이터베이스가 필요해졌다. 하지만 나는 트래픽이 적은(적다고 생각하는) 블로그를 위해서 24시간 켜져있는 별도의 PC를 구매하고 싶지 않았기 때문에 클라우드로 눈을 돌렸다.\n\n클라우드 중 가장 먼저 생각난 것은 대중적인 AWS EC2 인스턴스였다. AWS에 계정을 새로 만들면 1년간 월 750시간을 무료로 사용할 수 있는 EC2를 제공하지만 여러 가지 변수로 과금될 수 있고 1년 후에는 무료가 아니게 된다는 것이 걸렸다. 그 다음 눈을 돌린 것은 Heroku 였다. 한번도 사용해보지 않았지만 블로그에 적당한 스펙의 Dynos를 무료로 지원한다. 게다가 Postgresql 데이터베이스도 지원한다. 그래서 Heroku를 이용해 서버와 데이터베이스를 구현하기로 정했다.\n\n![Dynos](/posts/how-to-make-blog-views-count/dynos.png)\n\n\u003e Dynos(Heroku에서의 isolated, virtualized linux container)\n\n## 서버 어플리케이션 만들기\n\n가용한 서버가 준비됐으니 이제 서버 어플리케이션을 준비할 차례다. 최근에 NestJS에 관심이 생겼는데, 조회수를 세는 것이 NestJS를 사용해야 할만큼 통일성이 필요한 프로젝트는 아니었지만 시험 삼아 사용하기로 했다. NestJS의 셋업 경험은 굉장했다. cli로 nest project를 만들고(`nest new project-name`) CRUD Generator(`nest g resource posts`)로 보일러 플레이트를 뚝딱 만들었다.\n\n이제 데이터베이스와 연결해야 하는데, 우선 로컬에서 postgresql을 설치하고(`brew install postgresql`), typeorm으로 DB와 동기화된 데이터를 관리한다.(`yarn install @nestjs/typeorm typeorm pg`) 이후의 일은 간단히 post를 id로 조회하는 API(findAll, findOne)를 구현하고, post의 views를 increament하는 API를 만들면 끝난다. 처음에는 post를 통째로 update하는 API로 만들었는데, 그러면 views를 임의로 0으로 만들거나 말도 안되는 숫자로 만들 수 있을 것 같아서 increment로 제한해서 구현했다. 코드는 [Server Repo](https://github.com/solidw/solidw.github.io-server)에서 확인할 수 있다.\n\n근 2년만에 서버를 만들어봐서 SQL문에 세미콜론을 안붙이고 확인하다가 왜 데이터가 안쌓이는지 한참 헤메기도 하고, 로컬에 database 연결하는 법도 한참 헤맸던 것 같다. TypeORM의 repository.create는 단순히 entity를 만드는 함수인데, save를 호출하지 않고 왜 db에서 row가 create가 안되지 하고 헤매기도 했다. 그렇지만 안하던 걸 해보니까 즐거웠다. 새로운 경험은 언제나 즐겁다.\n\n서버 어플리케이션을 무사히 준비한 후 Heroku Dynos에 띄웠다. Heroku는 배포도 굉장히 간단했는데, Heroku 대시보드에서 GitHub 레포와 연결한 후 Procfile만 정의해주면 알아서 clone한 후 Procfile에 정의된 명령어(`yarn prod`)를 실행해줬다. 이제는 클라이언트에서 views를 조회하고 업데이트만 해주면 된다.\n\n## 클라이언트 기능 추가하기\n\n우선 Views를 직관적으로 표현해줄 수 있는 png 파일을 하나 받아오고 count를 받아서 렌더하는 `ViewCount.tsx` 컴포넌트를 만들었다. 클라이언트에서 기능을 구현하는 것은 익숙하기 때문에 금방 만들었다. react-query를 이용해서 포스트 페이지에 접속하면 모든 포스트에 대한 views를 받아오고, 포스트 페이지에 접속하면 increment 요청을 보내도록 했다. 한가지 염려되는 점은 세션ID를 체크하지 않아서 한 페이지에서 새로고침을 마구마구 하면 views가 마구마구 올라간다. 지금은 큰 문제가 될 것 같지 않아서 추후에 추가할 계획이다.\n\n![ViewCount 컴포넌트](/posts/how-to-make-blog-views-count/view-count.png)\n\n\u003e 우측 하단의 컴포넌트\n\n## 이대로 괜찮을까?\n\n고민이 있었다. 현재 클라이언트에 저장된 posts 파일에서 가져온 데이터만으로 정적 생성을 하고 있고, 이제는 서버에서도 post 데이터가 받아온다. 서버의 post 데이터는 views 값만 있다. 데이터의 관리 포인트가 2곳이 되었다. 그리고 id 값을 md 파일의 metadata로 손수 정의해주지만 새로운 포스팅을 쓸 때 다른 파일의 id와 중복되게 작성하는 등 실수할 여지가 큰 구조다. 궁극적으로는 포스트와 관련된 데이터를 모조리 서버로 옮기고 정적 생성할 때 서버에서 모든 데이터를 받아오는 것이 좋아보인다. 하지만 당장 필요하지 않으니 id 값을 조심스럽게 적어주기로 결정했다.\n\n## 후기\n\n주말을 이용해서 간단한 기능을 구현했다. 서버 구현할 때 조금 헤맸지만 앞으로 서버가 필요한 기능이 추가된다면 금방 추가할 수 있을 것 같다. 그리고 NestJS의 온보딩 경험이 꽤 괜찮아서 조금 더 관심을 갖고 사용하려고 한다. 이제 포스트의 views를 측정할 수 있게 되었으니 다음에는 코멘트 기능을 추가해야겠다. 블로그와 함께 나도 성장해서 더 풍성한 블로그가 되었으면 좋겠다.\n\n## 참고한 포스트\n\n- [Connecting Heroku Postgres with NestJS Backend](https://dev.to/omercalik/connecting-heroku-postgres-with-nestjs-backend-3p1j)\n"},"__N_SSG":true},"page":"/posts/[path]","query":{"path":"how-to-make-blog-views-count"},"buildId":"wfqkA46kRnNN_8jvVjxMr","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>